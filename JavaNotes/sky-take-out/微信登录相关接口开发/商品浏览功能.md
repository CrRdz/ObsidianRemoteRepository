
# 需求分析和设计
## 接口设计-查询分类
- 基本信息
	- Path:/user/category/list
	- Method:GET
- 请求参数
	Query
	
| 参数名称 | 是否必须 | 示例  | 备注                 |
| ---- | ---- | --- | ------------------ |
| type | 否    | 1   | 分类类型：1 菜品分类 2 套餐分类 |
- 返回数据

| 名称            | 类型       | 是否必须 | 默认值 | 备注  | 其他信息             |
| ------------- | -------- | ---- | --- | --- | ---------------- |
| code          | integer  | 必须   |     |     | format：int32     |
| data          | object[] | 必须   |     |     | item类型：object    |
| ├─ createTime | string   | 非必须  |     |     | format：date-time |
| ├─ createUser | integer  | 非必须  |     |     | format:int64     |
| ├─ id         | integer  | 必须   |     |     | format:int64     |
| ├─ name       | string   | 必须   |     |     |                  |
| ├─ sort       | integer  | 非必须  |     |     | format:int32     |
| ├─ status     | integer  | 非必须  |     |     | format:int32     |
| ├─ type       | integer  | 非必须  |     |     | format:int32     |
| ├─ updateTime | string   | 非必须  |     |     | format:date-time |
| ├─ updateUser | integer  | 非必须  |     |     | format:int64     |
| msg           | string   | 非必须  |     |     |                  |
## 接口设计-根据分类id查询菜品
- 基本信息
	- Path:/user/dish/list
	- Method:GET
- 请求参数
	Query
	
| 参数名称       | 是否必须 | 示例  | 备注   |
| ---------- | ---- | --- | ---- |
| categoryId | 是    |     | 分类id |
- 返回数据

| 名称              | 类型       | 是否必须 | 默认值 | 备注  | 其他信息             |
| --------------- | -------- | ---- | --- | --- | ---------------- |
| code            | integer  | 必须   |     |     | format：int32     |
| data            | object[] | 必须   |     |     | item类型：object    |
| ├─ categoryId   | integer  | 必须   |     |     | format:int64     |
| ├─ categoryName | string   | 非必须  |     |     |                  |
| ├─ description  | string   | 非必须  |     |     |                  |
| ├─ flavors      | object[] | 非必须  |     |     | item类型：object    |
| │ ├─ dishId     | integer  | 非必须  |     |     | format:int64     |
| │ ├─ id         | integer  | 非必须  |     |     | format:int64     |
| │ ├─ name       | string   | 非必须  |     |     |                  |
| │ ├─ value      | string   | 非必须  |     |     |                  |
| ├─ id           | integer  | 非必须  |     |     | format:int64     |
| ├─ image        | string   | 必须   |     |     |                  |
| ├─ name         | string   | 必须   |     |     |                  |
| ├─ price        | number   | 必须   |     |     |                  |
| ├─ status       | integer  | 非必须  |     |     | format:int32     |
| ├─ updateTime   | string   | 非必须  |     |     | format:date-time |
| msg             | string   | 非必须  |     |     |                  |

## 接口设计-根据分类id查询套餐
- 基本信息
	- Path:/user/setmeal/list
	- Method:GET
- 请求参数
	Query
	
| 参数名称       | 是否必须 | 示例  | 备注   |
| ---------- | ---- | --- | ---- |
| categoryId | 是    |     | 分类id |
- 返回数据

| 名称             | 类型       | 是否必须 | 默认值 | 备注  | 其他信息             |
| -------------- | -------- | ---- | --- | --- | ---------------- |
| code           | integer  | 必须   |     |     | format：int32     |
| data           | object[] | 必须   |     |     | item类型：object    |
| ├─ categoryId  | integer  | 必须   |     |     | format:int64     |
| ├─ createTime  | string   | 非必须  |     |     | format：date-time |
| ├─ createUser  | integer  | 非必须  |     |     | format:int64     |
| ├─ description | string   | 非必须  |     |     |                  |
| ├─ id          | integer  | 必须   |     |     | format:int64     |
| ├─ image       | string   | 必须   |     |     |                  |
| ├─ name        | string   | 非必须  |     |     |                  |
| ├─ price       | number   | 非必须  |     |     |                  |
| ├─ status      | integer  | 非必须  |     |     | format:int32     |
| ├─ updateTime  | string   | 非必须  |     |     | format:date-time |
| ├─ updateUser  | integer  | 非必须  |     |     | format:int64     |
| msg            | string   | 非必须  |     |     |                  |

## 接口设计-根据套餐id查询包含的菜品
- 基本信息
	- Path:/user/setmeal/dish/{id}
	- Method:GET
- 请求参数
	Query
	
| 参数名称 | 示例  | 备注   |
| ---- | --- | ---- |
| id   |     | 套餐id |
- 返回数据

| 名称             | 类型       | 是否必须 | 默认值 | 备注   | 其他信息          |
| -------------- | -------- | ---- | --- | ---- | ------------- |
| code           | integer  | 必须   |     |      |               |
| data           | object[] | 非必须  |     |      | item类型：object |
| ├─ copies      | number   | 必须   |     | 份数   |               |
| ├─ description | string   | 必须   |     | 菜品描述 |               |
| ├─ image       | string   | 必须   |     | 菜品图片 |               |
| ├─ name        | string   | 必须   |     | 菜品名称 |               |
| msg            | string   | 非必须  |     |      |               |
# 代码开发
## `DishController`

```java
@RestController("userDishController")  
@RequestMapping("/user/dish")  
@Slf4j  
@Api(tags = "C端-菜品浏览接口")  
public class DishController {  
    @Autowired  
    private DishService dishService;  
  
    /**  
     * 根据分类id查询菜品  
     *  
     * @param categoryId  
     * @return  
     */    @GetMapping("/list")  
    @ApiOperation("根据分类id查询菜品")  
    public Result<List<DishVO>> list(Long categoryId) {  
        Dish dish = new Dish();  
        dish.setCategoryId(categoryId);  
        dish.setStatus(StatusConstant.ENABLE);//查询起售中的菜品  
  
        List<DishVO> list = dishService.listWithFlavor(dish);  
  
        return Result.success(list);  
    }  
  
}
```
## `DishService`

```java
/**  
 * 条件查询菜品和口味  
 * @param dish  
 * @return  
 */
 List<DishVO> listWithFlavor(Dish dish);
```
## `DishServiceImpl`

```java
/**  
 * 条件查询菜品和口味  
 * @param dish  
 * @return  
 */public List<DishVO> listWithFlavor(Dish dish) {  
    List<Dish> dishList = dishMapper.list(dish);  
  
    List<DishVO> dishVOList = new ArrayList<>();  
  
    for (Dish d : dishList) {  
        DishVO dishVO = new DishVO();  
        BeanUtils.copyProperties(d,dishVO);  
  
        //根据菜品id查询对应的口味  
        List<DishFlavor> flavors = dishFlavorMapper.getByDishId(d.getId());  
  
        dishVO.setFlavors(flavors);  
        dishVOList.add(dishVO);  
    }  
  
    return dishVOList;  
}
```
## `DishMapper`

```java
/**  
 * 动态条件查询菜品  
 * @param dish  
 * @return  
 */
List<Dish> list(Dish dish);
```
## `DishMapper.xml`

```xml
<select id="list" resultType="Dish" parameterType="Dish">  
    select * from dish    <where>  
        <if test="name != null">  
            and name like concat('%',#{name},'%')        
        </if>  
        <if test="categoryId != null">  
            and category_id = #{categoryId}        
        </if>  
        <if test="status != null">  
            and status = #{status}        
        </if>  
    </where>  
    order by create_time desc
</select>
```
## `SetmealController`

```java
@RestController("userSetmealController")  
@RequestMapping("/user/setmeal")  
@Api(tags = "C端-套餐浏览接口")  
public class SetmealController {  
    @Autowired  
    private SetmealService setmealService;  
  
    /**  
     * 条件查询  
     *  
     * @param categoryId  
     * @return  
     */    
    @GetMapping("/list")  
    @ApiOperation("根据分类id查询套餐")  
    public Result<List<Setmeal>> list(Long categoryId) {  
        Setmeal setmeal = new Setmeal();  
        setmeal.setCategoryId(categoryId);  
        setmeal.setStatus(StatusConstant.ENABLE);  
  
        List<Setmeal> list = setmealService.list(setmeal);  
        return Result.success(list);  
    }  
  
    /**  
     * 根据套餐id查询包含的菜品列表  
     *  
     * @param id  
     * @return  
     */    
    @GetMapping("/dish/{id}")  
    @ApiOperation("根据套餐id查询包含的菜品列表")  
    public Result<List<DishItemVO>> dishList(@PathVariable("id") Long id) {  
        List<DishItemVO> list = setmealService.getDishItemById(id);  
        return Result.success(list);  
    }  
}
```
## `SetmealService`

```java
public interface SetmealService {  
    /**  
     * 条件查询  
     * @param setmeal  
     * @return  
     */    
     List<Setmeal> list(Setmeal setmeal);  
  
    /**  
     * 根据id查询菜品选项  
     * @param id  
     * @return  
     */    
     List<DishItemVO> getDishItemById(Long id);  
}
```
## `SetmealServiceImpl`

```java
/**  
 * 套餐业务实现  
 */  
@Service  
@Slf4j  
public class SetmealServiceImpl implements SetmealService {  
  
    @Autowired  
    private SetmealMapper setmealMapper;  
    @Autowired  
    private SetmealDishMapper setmealDishMapper;  
    @Autowired  
    private DishMapper dishMapper;  
  
    /**  
     * 条件查询  
     * @param setmeal  
     * @return  
     */    
    public List<Setmeal> list(Setmeal setmeal) {  
        List<Setmeal> list = setmealMapper.list(setmeal);  
        return list;  
    }  
  
    /**  
     * 根据id查询菜品选项  
     * @param id  
     * @return  
     */    
    public List<DishItemVO> getDishItemById(Long id) {  
        return setmealMapper.getDishItemBySetmealId(id);  
    }  
}
```
## `SetmealMapper`

```java
/**  
 * 动态条件查询套餐  
 * @param setmeal  
 * @return  
 */
 List<Setmeal> list(Setmeal setmeal);  
  
/**  
 * 根据套餐id查询菜品选项  
 * @param setmealId  
 * @return  
 */
 @Select("select sd.name, sd.copies, d.image, d.description " +  
        "from setmeal_dish sd left join dish d on sd.dish_id = d.id " +  
        "where sd.setmeal_id = #{setmealId}")  
List<DishItemVO> getDishItemBySetmealId(Long setmealId);
```
## `SetmealMapper.xml`

```xml
<select id="list" parameterType="Setmeal" resultType="Setmeal">  
    select * from setmeal    
    <where>  
        <if test="name != null">  
            and name like concat('%',#{name},'%')        
        </if>  
        <if test="categoryId != null">  
            and category_id = #{categoryId}        
        </if>  
        <if test="status != null">  
            and status = #{status}        
        </if>  
    </where>  
</select>
```
## `CategoryController`

```java
@RestController("userCategoryController")  
@RequestMapping("/user/category")  
@Api(tags = "C端-分类接口")  
public class CategoryController {  
  
    @Autowired  
    private CategoryService categoryService;  
  
    /**  
     * 查询分类  
     * @param type  
     * @return  
     */    
    @GetMapping("/list")  
    @ApiOperation("查询分类")  
    public Result<List<Category>> list(Integer type) {  
        List<Category> list = categoryService.list(type);  
        return Result.success(list);  
    }  
}
```