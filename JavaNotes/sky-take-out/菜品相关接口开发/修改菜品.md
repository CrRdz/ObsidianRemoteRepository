# 需求分析和设计

## 接口设计-根据id查询菜品
- 基本信息
	- Path: /admin/dish/{id}
	- Method:GET
- 请求参数
	路径参数

| 参数名称 | 示例  | 备注   |
| ---- | --- | ---- |
| id   | 101 | 菜品id |
- 返回数据

| 名称             | 类型       | 是否必须 | 默认值 | 备注  | 其他信息           |
| -------------- | -------- | ---- | --- | --- | -------------- |
| code           | number   | 必须   |     |     |                |
| data           | object   | 非必须  |     |     | formata:int64  |
| ├─ categoryId  | integer  | 非必须  |     |     |                |
| ├─ description | string   | 非必须  |     |     |                |
| ├─ flavors     | object[] | 非必须  |     |     | item 类型：object |
| │ ├─ dishId    | integer  | 非必须  |     |     | formata:int64  |
| │ ├─ id        | integer  | 非必须  |     |     | formata:int64  |
| │ ├─ name      | string   | 非必须  |     |     |                |
| │ ├─ value     | string   | 非必须  |     |     |                |
| ├─ id          | integer  | 非必须  |     |     | formata:int64  |
| ├─ image       | string   | 非必须  |     |     |                |
| ├─ name        | string   | 非必须  |     |     |                |
| ├─ price       | number   | 非必须  |     |     |                |
| msg            | string   | 非必须  |     |     |                |


- 根据类型查询分类（已实现）
- 文件上传（已实现）
## 接口设计-修改菜品
- 基本信息
	- Path:/admin/dish
	- Method:PUT
- 请求参数
	Headers
	
| 参数名称         | 参数值              | 是否必须 | 示例  | 备注  |
| ------------ | ---------------- | ---- | --- | --- |
| Content-type | application/json | 是    |     |     |
	Body
	
| 名称          | 类型       | 是否必须 | 默认值 | 备注  | 其他信息           |
| ----------- | -------- | ---- | --- | --- | -------------- |
| categoryId  | integer  | 必须   |     |     | format：int64   |
| description | string   | 非必须  |     |     |                |
| flavors     | object[] | 必须   |     |     | item 类型：object |
| ├─ dishId   | integer  | 必须   |     |     | format：int64   |
| ├─ id       | integer  | 必须   |     |     | format：int64   |
| ├─ name     | string   | 必须   |     |     |                |
| ├─ value    | string   | 必须   |     |     |                |
| id          | integer  | 必须   |     |     | format：int64   |
| image       | string   | 必须   |     |     |                |
| name        | string   | 必须   |     |     |                |
| price       | number   | 必须   |     |     |                |
| status      | integer  | 必须   |     |     | format：int32   |
- 返回数据

| 名称   | 类型      | 是否必须 | 默认值 | 备注  | 其他信息         |
| ---- | ------- | ---- | --- | --- | ------------ |
| code | integer | 必须   |     |     | format：int32 |
| data | string  | 非必须  |     |     |              |
| msg  | string  | 非必须  |     |     |              |
# 代码开发-根据id查询菜品
## `DishController`

```java
@GetMapping("/{id}")  
@ApiOperation("根据id查询菜品及其口味信息")  
public Result<DishVO> getById(@PathVariable Long id) {  
    log.info("根据id查询菜品及其口味信息：{}", id);  
    DishVO dishVO = dishService.getByIdWithFlavor(id);  
    return Result.success(dishVO);  
}
```
## `DishService`

```java
/**  
 * 根据id查询菜品及其口味信息  
 * @param id  
 * @return  
 */  
DishVO getByIdWithFlavor(Long id);
```
## `DishServiceImpl`

```java
@Override  
public DishVO getByIdWithFlavor(Long id) {  
    // 根据id查询菜品基本信息  
    Dish dish = dishMapper.getById(id);  
  
    // 根据dishId查询对应的口味信息  
    List<DishFlavor> dishFlavors = dishFlavorMapper.getByDishId(id);  
  
    // 封装成DishVO对象并返回  
    DishVO dishVO = new DishVO();  
    BeanUtils.copyProperties(dish, dishVO);  
    dishVO.setFlavors(dishFlavors);  
  
    return dishVO;  
}
```
## `DishFlavorMapper`

```java
/**  
 * 根据菜品id查询对应的口味数据  
 * @param dishId  
 * @return  
 */  
@Select("select * from dish_flavor where dish_id = #{dishId}")  
List<DishFlavor> getByDishId(Long dishId);
```
## `DishMapper`

[[删除菜品#^f98ec3| getById]]

# 代码开发-修改菜品
## `DishController`

```java
@PutMapping  
@ApiOperation("修改菜品")  
public Result update(@RequestBody DishDTO dishDTO) {  
    log.info("修改菜品：{}", dishDTO);  
    dishService.updateWithFlavor(dishDTO);  
    return Result.success();  
}
```

## `DishService`

```java
/**  
 * 根据id修改菜品基本信息，同时更新对应的口味数据  
 * @param dishDTO  
 */  
void updateWithFlavor(DishDTO dishDTO);
```
## `DishServiceImpl`

```java
/**  
 * 根据id修改菜品基本信息，同时更新对应的口味数据  
 * @param dishDTO  
 */  
@Override  
public void updateWithFlavor(DishDTO dishDTO) {  
    // 修改菜品表基本信息  
    Dish dish = new Dish();  
    BeanUtils.copyProperties(dishDTO, dish);  
  
    dishMapper.update(dish);  
  
    // 删除原有的口味数据  
    dishFlavorMapper.deleteByDishId(dishDTO.getId());  
  
    // 重新插入口味数据  
    List<DishFlavor> flavors = dishDTO.getFlavors();  
    if (flavors != null && flavors.size() > 0) {  
        flavors.forEach(dishFlavor -> {  
            dishFlavor.setDishId(dishDTO.getId());  
        });  
        // 向菜品口味表插入多条数据  
        dishFlavorMapper.insertBatch(flavors);  
    }  
}
```

## `DishMapper`

```java
/**  
 * 更新菜品信息  
 * @param dish  
 */  
@AutoFill(value = OperationType.UPDATE)  
void update(Dish dish);
```

## `DishMapper.xml`

```java
<update id="update">  
    update dish  
    <set>  
        <if test="name != null">name = #{name},</if>  
        <if test="categoryId != null">category_id = #{categoryId},</if>  
        <if test="price != null">price = #{price},</if>  
        <if test="image != null">image = #{image},</if>  
        <if test="description != null">description = #{description},</if>  
        <if test="updateTime != null">update_time = #{updateTime},</if>  
        <if test="updateUser != null">update_user = #{updateUser},</if>  
        <if test="status != null">status = #{status},</if>  
    </set>  
    where id = #{id}  
</update>
```
写动态SQL 使用set标签