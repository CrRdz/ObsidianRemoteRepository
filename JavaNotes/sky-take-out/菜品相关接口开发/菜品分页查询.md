# 需求分析和设计

业务规则
- 根据页码展示菜单信息
- 每页展示10条数据
- 分页查询时可以根据需要输入菜品名称 菜品分类 菜品状态进行查询
## 接口设计
- 基本信息
	- Path: /admin/dish/page
	- Method:GET
- 请求参数
	Query
	
| 参数名称       | 是否必须 | 示例   | 备注     |
| ---------- | ---- | ---- | ------ |
| page       | 是    | 1    | 页码     |
| pageSize   | 是    | 10   | 每页记录数  |
| name       | 否    | 鱼香肉丝 | 菜品名称   |
| categoryId | 否    | 1    | 分类id   |
| status     | 否    | 1    | 菜品售卖状态 |
- 返回数据

| 名称                | 类型       | 是否必须 | 默认值 | 备注   | 其他信息           |
| ----------------- | -------- | ---- | --- | ---- | -------------- |
| code              | integer  | 必须   |     |      | format:int32   |
| data              | object   | 必须   |     |      |                |
| ├─ records        | object[] | 非必须  |     |      | item 类型：object |
| │ ├─ id           | number   | 必须   |     |      |                |
| │ ├─ name         | string   | 必须   |     |      |                |
| │ ├─ price        | number   | 必须   |     |      |                |
| │ ├─ image        | string   | 必须   |     |      |                |
| │ ├─ description  | string   | 必须   |     |      |                |
| │ ├─ status       | integer  | 必须   |     |      |                |
| │ ├─ updateTime   | string   | 必须   |     |      |                |
| │ ├─ categoryName | string   | 必须   |     | 分类名称 |                |
| ├─ total          | integer  | 必须   |     |      | format:int64   |
| msg               | string   | 非必须  |     |      |                |
# 代码开发

根据菜品分页查询接口定义设计对应的DTO
```java
@Data  
public class DishPageQueryDTO implements Serializable {  
  
    private int page;  
  
    private int pageSize;  
  
    private String name;  
  
    //分类id  
    private Integer categoryId;  
  
    //状态 0表示禁用 1表示启用  
    private Integer status;  
  
}
```

根据菜品分页查询设计对应的VO
```java
@Data  
@Builder  
@NoArgsConstructor  
@AllArgsConstructor  
public class DishVO implements Serializable {  
  
    private Long id;  
    //菜品名称  
    private String name;  
    //菜品分类id  
    private Long categoryId;  
    //菜品价格  
    private BigDecimal price;  
    //图片  
    private String image;  
    //描述信息  
    private String description;  
    //0 停售 1 起售  
    private Integer status;  
    //更新时间  
    private LocalDateTime updateTime;  
    //分类名称  
    private String categoryName;  
    //菜品关联的口味  
    private List<DishFlavor> flavors = new ArrayList<>();  
  
    //private Integer copies;  
}
```
前端还需要展示菜品所在的分类名称 这需要通过left join查出来 所以不直接返回dish对象 通过DishVO来扩展它
## `DishController`

```java
@GetMapping("/page")  
@ApiOperation("菜品分页查询")  
public  Result<PageResult> page(DishPageQueryDTO dishPageQueryDTO) {  
    log.info("菜品分页查询：{}", dishPageQueryDTO);  
    PageResult pageResult = dishService.pageQuery(dishPageQueryDTO);  
    return Result.success(pageResult);  
}
```

## `DishService`

```java
/**  
 * 菜品分页查询  
 * @param dishPageQueryDTO  
 * @return  
 */  
PageResult pageQuery(DishPageQueryDTO dishPageQueryDTO);
```
## `DishServiceImpl`

```java
/**  
 * 菜品分页查询  
 * @param dishPageQueryDTO  
 * @return  
 */  
@Override  
public PageResult pageQuery(DishPageQueryDTO dishPageQueryDTO) {  
    PageHelper.startPage(dishPageQueryDTO.getPage(), dishPageQueryDTO.getPageSize());  
    Page<DishVO> page = dishMapper.pageQuery(dishPageQueryDTO);  
    return new PageResult(page.getTotal(), page.getResult());  
}
```
## `DishMapper`

```java
/**  
 * 菜品分页查询  
 * @param dishPageQueryDTO  
 * @return  
 */  
Page<DishVO> pageQuery(DishPageQueryDTO dishPageQueryDTO);
```

## `DishMapper.xml`

```java
<select id="pageQuery" resultType="com.sky.vo.DishVO">  
    select d.* , c.name as categoryName  
    from dish d    left outer join category c on d.category_id = c.id    <where>  
        <if test="name != null">  
            and d.name like concat('%', #{name}, '%')  
        </if>  
        <if test="categoryId != null">  
            and d.category_id = #{categoryId}  
        </if>  
        <if test="status != null">  
            and d.status = #{status}  
        </if>  
    </where>  
    order by d.create_time desc  
</select>
```
# 功能测试

前后端联调 + Swagger后端接口测试