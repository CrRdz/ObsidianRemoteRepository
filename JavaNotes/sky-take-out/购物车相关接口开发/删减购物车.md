# 需求分析和设计

## 接口设计
- 基本信息
	- Method：POST
	- Path：/user/shoppingCart/sub
- 请求参数：
	Body

| 参数名称      | 类型      | 是否必须 | 默认值 | 备注   |
| --------- | ------- | ---- | --- | ---- |
| setmealId | integer | 否    |     | 套餐id |
| dishId    | integer | 否    |     | 菜品id |
| flavor    | string  | 否    |     | 口味   |
- 返回数据 

| 名称   | 类型      | 是否必须 | 默认值 | 备注  | 其他信息         |
| ---- | ------- | ---- | --- | --- | ------------ |
| code | integer | 必须   |     |     | format：int32 |
| data | string  | 非必须  |     |     |              |
| msg  | string  | 非必须  |     |     |              |
# 代码开发

## `ShoppingCartController`

```java
/**  
 * 减少购物车商品数量  
 */  
@PostMapping("/sub")  
@ApiOperation("减少购物车商品数量")  
public Result sub(@RequestBody ShoppingCartDTO shoppingCartDTO){  
    log.info("减少购物车商品数量，商品信息为：{}", shoppingCartDTO);  
    shoppingCartService.subShoppingCart(shoppingCartDTO);  
    return Result.success();  
}
```
## `ShoppingCarterService`

```java
/**  
 * 减少购物车数量  
 * @param shoppingCartDTO  
 */  
void subShoppingCart(ShoppingCartDTO shoppingCartDTO);
```
## `ShoppingCarterServiceImpl`

```java
/**  
 * 减少购物车数量  
 * @param shoppingCartDTO  
 */  
@Override  
public void subShoppingCart(ShoppingCartDTO shoppingCartDTO) {  
    // 判断当前商品在购物车是否存在  
    ShoppingCart shoppingCart = new ShoppingCart();  
    BeanUtils.copyProperties(shoppingCartDTO, shoppingCart);  
    Long userId = BaseContext.getCurrentId();  
    shoppingCart.setUserId(userId);  
  
    List<ShoppingCart> list = shoppingCartMapper.list(shoppingCart);  
    if(list!= null && list.size()>0){  
        ShoppingCart cart = list.get(0);  
        Integer number = cart.getNumber();  
        if(number > 1){  
            // 如果数量大于1 则数量减一  
            cart.setNumber(number - 1);  
            shoppingCartMapper.updateNumberById(cart);  
        }else{  
            // 如果数量等于1 则删除该商品  
            shoppingCartMapper.deleteByUserId(userId);  
        }  
    }  
}
```