# 需求分析和设计

- 业务规则
	- 用户端/管理端都可以查询
	- 营业状态数据存储方式：基于Redis的字符串进行存储
	- 约定1表示营业 0表示打烊
## 接口设计-设置营业状态	
- 基本信息
	- Path:/admin/shop/{status}
	- Method:PUT
- 请求参数
	Headers
	
| 参数名称         | 参数值              | 是否必须 | 示例  | 备注  |
| ------------ | ---------------- | ---- | --- | --- |
| Content-type | application/json | 是    |     |     |
	路径参数
	
| 参数名称   | 示例  | 备注               |
| ------ | --- | ---------------- |
| status | 1   | 店铺营业状态：1为营业 0为打烊 |
- 返回数据

| 名称   | 类型      | 是否必须 | 默认值 | 备注  | 其他信息         |
| ---- | ------- | ---- | --- | --- | ------------ |
| code | integer | 必须   |     |     | format：int32 |
| data | string  | 非必须  |     |     |              |
| msg  | string  | 非必须  |     |     |              |

## 接口设计-管理端查询营业状态
- 基本信息
	- Path:/admin/shop/status
	- Method:GET
- 请求参数
- 返回数据

| 名称   | 类型      | 是否必须 | 默认值 | 备注  | 其他信息             |
| ---- | ------- | ---- | --- | --- | ---------------- |
| code | integer | 必须   |     |     |                  |
| data | string  | 必须   |     |     | 店铺营业状态：1为营业 0为打烊 |
| msg  | string  | 非必须  |     |     |                  |
## 接口设计-用户端查询营业状态
- 基本信息
	- Path:/user/shop/status
	- Method:GET
- 请求参数
- 返回数据

| 名称   | 类型      | 是否必须 | 默认值 | 备注  | 其他信息             |
| ---- | ------- | ---- | --- | --- | ---------------- |
| code | integer | 必须   |     |     |                  |
| data | string  | 必须   |     |     | 店铺营业状态：1为营业 0为打烊 |
| msg  | string  | 非必须  |     |     |                  |
# 代码开发
## `ShopController`

```java
@RestController("adminShopController")  
@RequestMapping("/admin/shop")  
@Api(tags = "店铺相关接口")  
@Slf4j  
public class ShopController {  
  
    public static final String KEY = "SHOP_STATUS";  
  
    @Autowired  
    private RedisTemplate redisTemplate;  
  
    @PutMapping("/{status}")  
    @ApiOperation("设置商铺状态")  
    public Result setStatus(@PathVariable Integer status) {  
        log.info("设置商铺状态: {}", status == 1 ? "营业中" : "打烊中");  
        redisTemplate.opsForValue().set("SHOP_STATUS", status);  
        return Result.success();  
    }  
  
    @GetMapping("/status")  
    @ApiOperation("获取商铺状态")  
    public Result<Integer> getStatus() {  
        Integer status = (Integer) redisTemplate.opsForValue().get(KEY);  
        log.info("获取商铺状态为:{}", status == 1 ? "营业中" : "打烊中");  
        return Result.success(status);  
    }  
  
}
```

# 代码优化
## `WebMVCConfiguration`

```java
/**  
 * 通过knife4j生成接口文档  
 * @return  
 */  
@Bean  
public Docket docket1() {  
    ApiInfo apiInfo = new ApiInfoBuilder()  
            .title("苍穹外卖项目接口文档")  
            .version("2.0")  
            .description("苍穹外卖项目接口文档")  
            .build();  
    Docket docket = new Docket(DocumentationType.SWAGGER_2)  
            .groupName("管理端接口")  
            .apiInfo(apiInfo)  
            .select()  
            .apis(RequestHandlerSelectors.basePackage("com.sky.controller.admin"))  
            .paths(PathSelectors.any())  
            .build();  
    return docket;  
}  
  
/**  
 * 通过knife4j生成接口文档  
 * @return  
 */  
@Bean  
public Docket docket2() {  
    ApiInfo apiInfo = new ApiInfoBuilder()  
            .title("苍穹外卖项目接口文档")  
            .version("2.0")  
            .description("苍穹外卖项目接口文档")  
            .build();  
    Docket docket = new Docket(DocumentationType.SWAGGER_2)  
            .groupName("用户端接口")  
            .apiInfo(apiInfo)  
            .select()  
            .apis(RequestHandlerSelectors.basePackage("com.sky.controller.user"))  
            .paths(PathSelectors.any())  
            .build();  
    return docket;  
}
```

在Swagger中分开扫描 变成两个不同的测试组